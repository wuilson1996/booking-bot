{% extends 'layouts/base.html' %}
{% block title %} Dashboard {% endblock title %}
{% load static %}
<!-- Specific CSS goes HERE -->
{% block stylesheets %}
{% endblock stylesheets %}

{% block content %}
<style>
  .dataTable-dropdown {
    display: none !important;
  }
  #client-list_wrapper {
  margin-top: 0 !important;
  padding-top: 0 !important;
}

.dataTable-container {
  padding-top: 0 !important;
  margin-top: 0 !important;
}

.dataTable-top {
  display: none !important; /* Si es un contenedor del buscador u opciones arriba */
}
</style>
<div class="m-4 row">
  <div class="col-12">
    <div class="card">
      <div class="pb-4 card-body">
          <div class="row">
            <div class="col-md-1">
              <img src="/static/assets/img/logo.png" style="width: 100px;" alt="Logo">
            </div>
            <div class="col-md-5">
              <div class="card p-3 bg-secondary m-1">
                <form action="" method="post">{% csrf_token %}
                  <div class="row">
                    <div class="col-md-3">
                      <input type="date" class="form-control" value="{{date_from}}" name="date_from" id="date_from">
                    </div>
                    <!--<div class="col-md-2">
                      <input type="date" class="form-control" value="{{date_to}}" name="date_to">
                    </div>-->
                    <div class="col-md-3">
                      <select name="range_bt" id="range_bt" class="form-control">
                        <option value="1" {% if range_bt == '1' %}selected{% endif %}>Todo</option>
                        <option value="2" {% if range_bt == '2' %}selected{% endif %}>Igual a cero</option>
                        <option value="3" {% if range_bt == '3' %}selected{% endif %}>Distinto de cero</option>
                      </select>
                    </div>
                    <div class="col-md-3">
                      <select name="range_pg" id="range_pg" class="form-control">
                        <option value="7" {% if range_pg == '7' %}selected{% endif %}>7 Dias</option>
                        <option value="15" {% if range_pg == '15' %}selected{% endif %}>15 Dias</option>
                        <option value="30" {% if range_pg == '30' %}selected{% endif %}>30 Dias</option>
                        <option value="60" {% if range_pg == '60' %}selected{% endif %}>60 Dias</option>
                        <option value="90" {% if range_pg == '90' %}selected{% endif %}>90 Dias</option>
                        <option value="180" {% if range_pg == '180' %}selected{% endif %}>180 Dias</option>
                      </select>
                    </div>
                    <div class="col-md-2">
                      <button type="submit" class="btn btn-info">Filtrar</button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card p-3 bg-secondary m-1">
                <div class="row">
                  <div class="col-12 col-sm-1 mt-2">
                    <div class="d-flex mt-4">
                      <label for="" class="text-white m-1">Auto:</label>
                      <div class="my-auto form-check">
                          <input class="form-check-input" type="checkbox" value="" id="bot_auto" {% if bot_auto.automatic %}checked{% endif %}>
                      </div>
                    </div>
                  </div>
                  <!-- <div class="col-12 col-sm-2">
                    <label for="" class="text-white">Rango</label>
                    <select name="bot_range" id="bot_range" class="form-control">
                      {% for r in bot_range %}
                        <option value="{{r.pk}}" {% if bot_setting.number_from == r.number %}selected{% endif %}>{{r.days}} Dias</option>
                      {% endfor %}
                    </select>
                  </div> -->
                  <div class="col-12 col-sm-3">
                    <label for="" class="text-white">Desde</label>
                    <input type="date" class="form-control" value="{{date_process_from}}" name="date_process_from" id="date_process_from">
                  </div>
                  <div class="col-12 col-sm-3">
                    <label for="" class="text-white">Hasta</label>
                    <input type="date" class="form-control" value="{{date_process}}" name="date_process" id="date_process" min="{{date_from}}">
                  </div>
                  <div class="col-12 col-sm-3 mt-2">
                    <button class="mt-4 btn w-100 btn-dark" id="buttonActive" type="button">
                      <i class="fas fa-key me-1"></i>
                      Activar extraccion
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
              <div class="col-12 col-sm-12">
                  <div class="row gx-4 card bg-secondary m-1 p-3">
                      <!--<div class="col-auto">
                        <div class="avatar avatar-xl position-relative">
                          <img src="/static/assets/img/logo.png" style="width: 100px;" alt="Logo">
                        </div>
                      </div>-->
                      <!--<div class="col-auto my-auto">
                        <div class="h-100">
                          <h5 class="mb-1">
                            {{request.user.username}}
                          </h5>
                          <p class="mb-0 font-weight-bold text-sm">
                            Usuario - {{request.user.username}}
                          </p>
                          <p class="mb-0 font-weight-bold text-sm">
                            Email - {{request.user.email}}
                          </p>
                        </div>
                      </div>-->
                      <div class="col-md-12">
                        <div class="row">
                          <div class="col-md-2">
                            <h6 class="text-white">Booking: </h6>
                          </div>
                          <div class="col-md-10">
                            <p id="addLogBooking" class="text-white"></p>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-md-2">
                            <h6 class="text-white">RoomPrice: </h6>
                          </div>
                          <div class="col-md-10">
                            <p id="addLogRoomPrice" class="text-white"></p>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-md-2">
                            <h6 class="text-white">SuitesFeria: </h6>
                          </div>
                          <div class="col-md-10">
                            <p id="addLogSuitesFeria" class="text-white"></p>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-md-2">
                            <h6 class="text-white">Copia de precios: </h6>
                          </div>
                          <div class="col-md-10">
                            <p id="addLogCopyPrice" class="text-white"></p>
                          </div>
                        </div>
                      </div>
                  </div>
              </div>
              <!--<div class="col-12 col-sm-5 text-center">
                <img src="/static/assets/img/logo.png" style="width: 100px;" alt="Logo">
              </div>-->
              <!--<div class="col-12 col-sm-3">
                  {% if not user_info.active %}
                      <span class="badge badge-success badge-sm">Activo</span>
                  {% else %}
                      <span class="badge badge-danger badge-sm">No activo</span>
                  {% endif %}
              </div>-->
          </div>
        </div>
    </div>
  </div>
</div>

<div class="m-0 row">
  <div class="col-12">
    <div class="card">
      <!-- Card header -->
      <!--<div class="pb-0 card-header">
        <div class="row">
          <div class="col-md-2">
            <h5 class="mb-0">Bookings</h5>
            <p class="mb-0 text-sm">
              
            </p>
          </div>
          
          <div class="col-md-2 my-auto mt-4 ms-auto mt-lg-0 text-end">
            <div class="my-auto ms-auto">
              <button class="mt-1 mb-0 btn btn-white export mt-sm-0" data-type="csv" type="button" name="button">
                <svg width="14" height="15" viewBox="0 0 20 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M3 17.5C3 16.9477 3.44772 16.5 4 16.5H16C16.5523 16.5 17 16.9477 17 17.5C17 18.0523 16.5523 18.5 16 18.5H4C3.44772 18.5 3 18.0523 3 17.5ZM6.29289 7.20711C5.90237 6.81658 5.90237 6.18342 6.29289 5.79289L9.29289 2.79289C9.48043 2.60536 9.73478 2.5 10 2.5C10.2652 2.5 10.5196 2.60536 10.7071 2.79289L13.7071 5.79289C14.0976 6.18342 14.0976 6.81658 13.7071 7.20711C13.3166 7.59763 12.6834 7.59763 12.2929 7.20711L11 5.91421V13.5C11 14.0523 10.5523 14.5 10 14.5C9.44771 14.5 9 14.0523 9 13.5V5.91421L7.70711 7.20711C7.31658 7.59763 6.68342 7.59763 6.29289 7.20711Z" fill="#111827" />
                </svg>Export
              </button>
            </div>
          </div>
          
        </div>
      </div>-->
      <div class="px-0 pb-0 card-body">
        <div class="table-responsive">
          <table class="table table-flush table-sm m-0 p-0" id="client-list">
            <thead class="thead-light">
              <tr>
                <th class="text-xs">Fecha</th>
                <th class="text-xs">Tipo</th>
              </tr>
            </thead>
            <tbody>
              {% for date, value in bookings.items %}
              <tr>
                <td id="temp-bg{{date}}" style="width: 40px;" class="text-sm m-1 p-1 {% if 'temporadaByDay' in value %}{{value.temporadaByDay.bgColor}}{% else %}bg-success{% endif %} {% if 'temporadaByDay' in value %}{{value.temporadaByDay.textColor}}{% else %}text-white{% endif %} text-center">
                  <div class="col-md-2 bg-secondary" style="width: 200px;">
                    <span class="bg-secondary text-start">
                      <span class="h2 text-bold text-white">{{value.2.total_search}}</span> | 
                      <span class="h4 text-bold text-white">{{value.2.total_search1}}</span> | 
                      <span class="h4 text-bold text-white">{{value.2.total_search7}}</span>
                      <br>
                      <h5 class="h5 text-bold text-white bg-secondary w-50">{{value.2.total_search_192}}% | <span class="bg-success h4 text-white ps-1 pe-1">00</span></h5>
                    </span>
                  </div>
                  <h4 class="text-white my-4">{{value.date_from}}</h4>
                  <h4 class="text-white my-4">{{value.day}}</h4>
                  <hr>
                  <h3 id="temp-n{{date}}" class="{% if 'temporadaByDay' in value %}{{value.temporadaByDay.textColor}}{% else %}text-white{% endif %}">{{value.temporadaByDay.number}}</h3>
                  <div class="input-group mb-3">
                    <select id="temp{{date}}" class="form-control form-control-sm" value="{{value.temporadaByDay.number}}">
                      <option value="">Seleccionar</option>
                      <option value="0" {% if value.temporadaByDay.number == '0' %}selected{% endif %}>Temporada 0</option>
                      <option value="1" {% if value.temporadaByDay.number == '1' %}selected{% endif %}>Temporada 1</option>
                      <option value="2" {% if value.temporadaByDay.number == '2' %}selected{% endif %}>Temporada 2</option>
                      <option value="3" {% if value.temporadaByDay.number == '3' %}selected{% endif %}>Temporada 3</option>
                      <option value="4" {% if value.temporadaByDay.number == '4' %}selected{% endif %}>Temporada 4</option>
                      <option value="5" {% if value.temporadaByDay.number == '5' %}selected{% endif %}>Temporada 5</option>
                    </select>
                    <button class="btn btn-white btn-xs mb-0 text-lg" type="button" id="button-addon7" onclick="tempOption('{{date}}')">Guardar</button>
                  </div>
                  <hr>
                  <h4 class="text-white my-4" id="buttonFeeUpgrade{{date}}">...</h4>
                  <button class="btn btn-white" onclick="upgradeFee('{{date}}')">Actualizar Tarifa</button>
                  <hr>
                  <h1 class="text-white my-4" id="temp-t{{date}}">{{value.totalFeria}}</h1>
                  <div class="input-group mb-3">
                    <button class="btn btn-white btn-xs mb-0 text-lg" type="button" id="button-addon11" onclick="saveAvailWithDate('{{date}}')">Guardar</button>
                    <input type="number" class="form-control form-control-lg text-lg" placeholder="Disponibilidad" value="{{value.availWithDate}}" aria-describedby="button-addon11" id="avail{{date}}">
                  </div>
                  <h2 id="temp-n2{{date}}" class="{{value.availWithDateRest.color}} my-4 {% if value.temporadaByDay.bgColor == 'bg-danger' and value.availWithDateRest.color == 'text-danger' %}bg-white{% endif %}">{{value.availWithDateRest.value}}</h2>
                  <hr>
                  <span id="temp-update{{date}}">{{value.updated}}</span>
                  </br>
                  </br>
                </td>
                <td class="m-1 p-1">
                  <table class="table table-flush text-white table-sm m-1 p-1" id="bgtable{{date}}2" style="background-color: {{value.2.messageDay.bg_color}};"> <!-- Change backgroud -->
                    <!-- <thead class="thead-light">
                      <tr>
                        <th class="text-xs"></th>
                        <th class="text-xs text-white">Precio en base a nombre de hotel</th>
                        <th class="text-xs text-white">H. DSP. (4*)</th>
                        <th class="text-xs text-white">Precio hotel 3*</th>
                        <th class="text-xs text-white">Precio hotel 4*</th>
                        <th class="text-xs text-white">Media</th>
                      </tr>
                    </thead> -->
                    <tbody>
                      <tr class="m-1 p-1">
                        <td colspan="6" class="m-0 p-0">
                          <div class="row">
                            <!-- <div class="col-md-2 bg-danger" style="width: 200px;">
                              <span class="bg-danger text-start">
                                <span class="h2 text-bold text-white">{{value.2.total_search}}</span> | 
                                <span class="h4 text-bold text-white">{{value.2.total_search1}}</span> | 
                                <span class="h4 text-bold text-white">{{value.2.total_search7}}</span>
                                <br>
                                <h5 class="h4 text-bold text-white bg-danger w-50">{{value.2.total_search_192}}%</h5>
                              </span>
                            </div> -->
                            <div class="col-md-12">
                              <div class="input-group mb-3">
                                <button class="btn btn-white btn-xs mb-0 text-lg" type="button" id="button-addon7" onclick="saveEvent('{{date}}', 2)">Guardar</button>
                                <textarea class="form-control form-control-lg text-lg" placeholder="Fijar evento" rows="2" aria-describedby="button-addon7" id="textEvent{{date}}2">{{value.2.eventByDay.text}}</textarea>
                              </div>
                            </div>
                          </div>
                        </td>
                      </tr>
                      <tr class="m-1 p-1">
                        <td class="text-sm m-1 p-1">
                          <span id="textDate{{date}}2" class="text-lg m-2 text-xl">{{value.2.messageDay.updated}}</span>
                          <div class="input-group mb-3">
                            <button class="btn btn-white btn-xs mb-0" style="font-size: 14px;" type="button" id="button-addon2" onclick="saveMessage('{{date}}', 2, '{{date}}2')">Guardar</button>
                            <select type="text" class="form-control form-control-lg text-lg" value="{{value.2.messageDay.pk}}" aria-describedby="button-addon2" id="text{{date}}2">
                             {% for mn in message_name2 %} 
                              <option value="{{mn.pk}}" {% if value.2.messageDay.pk == mn.pk %}selected{% endif %} style="background-color: {{mn.bg_color}};">{{mn.name}}</option>
                              {% endfor %}
                            </select>
                          </div>
                          <!---->
                          <span class="text-white text-lg" id="priceDate{{date}}2">{{value.2.tarifa.updated}}</span>
                          <div class="input-group mb-3">
                            <button class="btn btn-white btn-xs mb-0" style="font-size: 14px;" type="button" id="button-addon1" onclick="savePrice('{{date}}', 2, '{{date}}2')">
                              Guardar <i id="iconStatus{{date}}2" class="{% if not value.2.tarifa.pSync %}fas fa-exclamation-triangle text-warning fa-2x{% else %}fa fa-check text-success fa-2x{% endif %}"></i>
                            </button>
                            <input type="text" class="form-control form-control-lg text-lg" placeholder="Tarifa RoomPrice" value="{{value.2.tarifa.price}}" aria-describedby="button-addon1" id="price{{date}}2">
                          </div>
                          <span class="text-white text-lg" id="priceDate{{date}}1">{{value.2.tarifa1.updated}}</span>
                          <div class="input-group mb-3">
                            <button class="btn btn-white btn-xs mb-0" style="font-size: 14px;" type="button" id="button-addon1" onclick="savePrice('{{date}}', 1, '{{date}}1')">
                              Guardar <i id="iconStatus{{date}}1" class="{% if not value.2.tarifa1.pSync %}fas fa-exclamation-triangle text-warning fa-2x{% else %}fa fa-check text-success fa-2x{% endif %}"></i>
                            </button>
                            <input type="text" class="form-control form-control-lg text-lg" placeholder="Tarifa RoomPrice" value="{{value.2.tarifa1.price}}" aria-describedby="button-addon1" id="price{{date}}1">
                          </div>
                          <!---->
                        </td>
                        <td class="text-sm tr m-1 p-1" data-bs-toggle="tooltip" data-bs-placement="left" title="Ir a lista de dobles" onclick="window.location.href='/booking?date={{date}}&occupancy=2'">
                          <h4 class="text-white text-start">
                            <table class="table table-flush text-white table-sm m-1 p-1">
                              <tbody>
                                <tr>
                                  <td class="m-1 p-1">
                                    <h2 class="text-white bg-success text-center">0</h2>
                                    <span class="h3 text-bold text-white">
                                      {% if "priceSuitesFeria" in value.2 %}{{value.2.priceSuitesFeria}}{% else %}0{% endif %}|</span>
                                      {% if "priceSuitesFeria1" in value.2 %}{{value.2.priceSuitesFeria1}}{% else %}0{% endif %}|
                                      {% if "priceSuitesFeria4" in value.2 %}{{value.2.priceSuitesFeria4}}{% else %}0{% endif %}|
                                      {% if "priceSuitesFeria7" in value.2 %}{{value.2.priceSuitesFeria7}}{% else %}0{% endif %}
                                      <br>
                                    <span class="bg-dark">
                                    <span class="h2 text-bold text-white text-start">
                                      {% if "totalFeria" in value.2 %}{{value.2.totalFeria}}{% else %}0{% endif %} |
                                      {% if "totalFeria1" in value.2 %}{{value.2.totalFeria1}}{% else %}0{% endif %} | 
                                      {% if "totalFeria7" in value.2 %}{{value.2.totalFeria7}}{% else %}0{% endif %}
                                    </span>
                                    <br>
                                    M: <span style="font-size: 28px;">{% if "suiteFeria1" in value.2 %}{{value.2.suiteFeria1}}{% else %}0{% endif %}</span> | 
                                    <span style="font-size: 28px;">{% if "totalFeriaM1" in value.2 %}{{value.2.totalFeriaM1}}{% else %}0{% endif %}</span> | 
                                    <span style="font-size: 28px;">{% if "totalFeriaM7" in value.2 %}{{value.2.totalFeriaM7}}{% else %}0{% endif %}</span>
                                    <br>
                                    D: <span style="font-size: 28px;">{% if "suiteFeria" in value.2 %}{{value.2.suiteFeria}}{% else %}0{% endif %}</span> | 
                                    <span style="font-size: 28px;">{% if "totalFeriaD1" in value.2 %}{{value.2.totalFeriaD1}}{% else %}0{% endif %}</span> | 
                                    <span style="font-size: 28px;">{% if "totalFeriaD7" in value.2 %}{{value.2.totalFeriaD7}}{% else %}0{% endif %}</span>
                                    </span>
                                  </td>
                                  <!-- <td>
                                    {% if "priceSuitesFeriaRest1" in value.2 %}{{value.2.priceSuitesFeriaRest1}}{% else %}0{% endif %} | 
                                    {% if "priceSuitesFeriaRest7" in value.2 %}{{value.2.priceSuitesFeriaRest7}}{% else %}0{% endif %}
                                  </td> -->
                                </tr>
                              </tbody>
                            </table>
                          </h4>
                        </td>
                        <td class="text-sm tr m-1 p-1" data-bs-toggle="tooltip" data-bs-placement="left" title="Ir a lista de dobles" onclick="window.location.href='/booking?date={{date}}&occupancy=2'">
                          <table class="m-1 p-1">
                            <tbody>
                              <tr>
                                <td class="text-sm m-1 p-1 w-10">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{% if "media_total03" in value.2 %}{% widthratio value.2.media_total03 value.2.media_cant03 1 %}{% else %}0{% endif %}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 60px; height: 15px; font-size: 10px;">
                                      PM3*
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm m-1 p-1 w-10">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0 text-white">{% if "media_total" in value.2 %}{% widthratio value.2.media_total value.2.media_cant 1 %}{% else %}0{% endif %}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 60px; height: 15px; font-size: 10px;">
                                      PM4*
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm m-1 p-1 w-10">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0 text-white">{% if "media_total1" in value.2 %}{% widthratio value.2.media_total1 value.2.media_cant1 1 %}{% else %}0{% endif %}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 60px; height: 15px; font-size: 10px;">
                                      PM4*-1D
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm m-1 p-1 w-10">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0 text-white">{% if "media_total4" in value.2 %}{% widthratio value.2.media_total4 value.2.media_cant4 1 %}{% else %}0{% endif %}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 60px; height: 15px; font-size: 10px;">
                                      PM4*-4D
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm m-1 p-1 w-10">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0 text-white">{% if "media_total7" in value.2 %}{% widthratio value.2.media_total7 value.2.media_cant7 1 %}{% else %}0{% endif %}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 60px; height: 15px; font-size: 10px;">
                                      PM4*-7D
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm m-1 p-1 w-10">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{% if "media_general" in value.2 %}{{value.2.media_general}}{% else %}0{% endif %}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 60px; height: 15px; font-size: 10px;">
                                      PM4*MIX
                                    </span>
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                          <table class="table table-flush text-white table-sm m-1 p-1">
                            <tbody>
                              <tr class="m-1 p-1">
                                <td class="text-sm bg-success m-0 p-0">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0">{{ value.2.4.0.price }}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      1
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.2.4.1.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      2
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.2.4.2.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      3
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.2.4.3.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      4
                                    </span>
                                  </div>
                                </td>
                                <td class="bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0 text-white">{{value.2.4.4.price}}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      5
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-white m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0">{{value.2.4.9.price}}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      10
                                    </span>
                                  </div>
                                </td>
                                <td class="bg-primary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0 text-white">{{value.2.4.14.price}}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      15
                                    </span>
                                  </div>
                                </td>
                                <td class="bg-warning m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0 text-white">{{value.2.4.19.price}}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      20
                                    </span>
                                  </div>
                                </td>
                                <td class="bg-danger m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0 text-white">{{value.2.4.24.price}}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      25
                                    </span>
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                          <table class="table table-flush text-white table-sm m-1 p-1">
                            <tbody>
                              <tr>
                                <td class="text-sm bg-success m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h2 class="m-0">{{value.2.3.0.price}}</h2>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      I
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.2.3.1.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      II
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.2.3.2.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      III
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.2.3.3.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      IV
                                    </span>
                                  </div>
                                </td>
                                <td class="text-lg bg-white m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0">{{value.2.3.4.price}}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      V
                                    </span>
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </td>
                        <td class="text-sm bg-warning text-white tr m-1 p-1" data-bs-toggle="tooltip" data-bs-placement="left" title="Ir a lista de dobles" onclick="window.location.href='/booking?date={{date}}&occupancy=2'">
                          <table class="table table-flush text-white table-sm m-1 p-1">
                            <tbody>
                              <tr>
                                <td class="text-sm m-1 p-1">
                                  <span style="font-size: 32px; color: black; font-weight: bold;">
                                    <span class="h3 text-bold text-black">
                                      {% if "media_name_hotel" in value.2 %}
                                        {% widthratio value.2.media_name_hotel value.2.media_cant_name_hotel 1 %}
                                      {% else %}0{% endif %} | 
                                      0 | 
                                      0
                                    </span>
                                  </span><br>
                          
                                  <div class="d-flex justify-content-between">
                                    <span class="h4 text-bold text-white m-0">ZEN: {% if 'priceZEN' in value.2 %}{{value.2.priceZEN}}{% else %}0{% endif %}</span>
                                    <span class="h4 text-bold text-white m-0">ECO: {% if 'priceECO' in value.2 %}{{value.2.priceECO}}{% else %}0{% endif %}</span>
                                  </div>
                          
                                  <div class="d-flex justify-content-between">
                                    <span class="h4 text-bold text-white m-0">SIL: {% if 'priceSIL' in value.2 %}{{value.2.priceSIL}}{% else %}0{% endif %}</span>
                                    <span class="h4 text-bold text-white m-0">ILU: {% if 'priceILU' in value.2 %}{{value.2.priceILU}}{% else %}0{% endif %}</span>
                                  </div>
                          
                                  <div class="d-flex justify-content-between">
                                    <span class="h4 text-bold text-white m-0">AXO: {% if 'priceAXO' in value.2 %}{{value.2.priceAXO}}{% else %}0{% endif %}</span>
                                    <span class="h4 text-bold text-white m-0">SER: {% if 'priceSER' in value.2 %}{{value.2.priceSER}}{% else %}0{% endif %}</span>
                                  </div>
                          
                                  <div class="d-flex justify-content-between">
                                    <span class="h4 text-bold text-white m-0">BOS: {% if 'priceBOS' in value.2 %}{{value.2.priceBOS}}{% else %}0{% endif %}</span>
                                    <span class="h4 text-bold text-white m-0">EXE: {% if 'priceEXE' in value.2 %}{{value.2.priceEXE}}{% else %}0{% endif %}</span>
                                  </div>
                          
                                  <div class="d-flex justify-content-between">
                                    <span class="h4 text-bold text-white m-0">DWO: {% if 'priceDWO' in value.2 %}{{value.2.priceDWO}}{% else %}0{% endif %}</span>
                                    <span class="h4 text-bold text-white m-0">OSU: {% if 'priceOSU' in value.2 %}{{value.2.priceOSU}}{% else %}0{% endif %}</span>
                                  </div>
                          
                                  <div class="d-flex justify-content-between">
                                    <span class="h4 text-bold text-white m-0">SEN: {% if 'priceSEN' in value.2 %}{{value.2.priceSEN}}{% else %}0{% endif %}</span>
                                    <span class="h4 text-bold text-white m-0">TOR: {% if 'priceTOR2' in value.2 %}{{value.2.priceTOR2}}{% else %}0{% endif %}</span>
                                  </div>
                          
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </td>
                        <td class="text-sm bg-danger text-white tr m-1 p-1" data-bs-toggle="tooltip" data-bs-placement="left" title="Ir a lista de dobles" onclick="window.location.href='/booking?date={{date}}&occupancy=2'">
                          <table class="table table-flush text-white table-sm m-1 p-1">
                            <tbody>
                              <tr>
                                <td class="text-sm m-1 p-1">
                                  <span class="h4 text-bold text-white m-2">PM+50%: {{value.2.media_name_50}}</span>
                                  <br>
                                  <span class="h4 text-bold text-white m-2">PM+40%: {{value.2.media_name_40}}</span>
                                  <br>
                                  <span class="h4 text-bold text-white m-2">PM+30%: {{value.2.media_name_30}}</span>
                                  <br>
                                  <span class="h4 text-bold text-white m-2">PM+20%: {{value.2.media_name_20}}</span>
                                  <br>
                                  <span class="h4 text-bold text-white m-2">PM+10%: {{value.2.media_name_10}}</span>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </td>
                      </tr>
                      <!-- <tr>
                        <td colspan="6">
                          <div class="row">
                            <div class="col-md-4">
                              <div class="input-group mb-3">
                                <button class="btn btn-white btn-xs mb-0 text-lg" type="button" id="button-addon2" onclick="saveMessage('{{date}}', 2, '{{date}}2')">Guardar</button>
                                <input type="text" class="form-control form-control-lg text-lg" placeholder="Fija un mensaje para este tipo" value="{{value.2.messageDay.text}}" aria-describedby="button-addon2" id="text{{date}}2">
                                <span id="textDate{{date}}2" class="text-lg m-2 text-xl">{{value.2.messageDay.updated}}</span>
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="input-group mb-3">
                                <button class="btn btn-success btn-xs mb-0 text-lg" type="button" id="button-addon6" onclick="saveMessage('{{date}}', 3, '{{date}}3')">Guardar</button>
                                <input type="text" class="form-control form-control-lg text-lg" placeholder="Fija un mensaje para este tipo" value="{{value.3.messageDay.text}}" aria-describedby="button-addon6" id="text{{date}}3">
                                <span id="textDate{{date}}3" class="text-lg m-2">{{value.3.messageDay.updated}}</span>
                              </div>
                            </div>
                            <div class="col-md-4">
                              <div class="input-group mb-3">
                                <button class="btn btn-danger btn-xs mb-0 text-lg" type="button" id="button-addon6" onclick="saveMessage('{{date}}', 5, '{{date}}5')">Guardar</button>
                                <input type="text" class="form-control form-control-lg text-lg" placeholder="Fija un mensaje para este tipo" value="{{value.5.messageDay.text}}" aria-describedby="button-addon6" id="text{{date}}5">
                                <span id="textDate{{date}}5" class="text-lg m-2">{{value.5.messageDay.updated}}</span>
                              </div>
                            </div>
                          </div>
                        </td>
                      </tr> -->
                    </tbody>
                  </table>
                  <table class="table table-flush text-white table-sm m-1 p-1" id="bgtable{{date}}3" style="background-color: {{value.3.messageDay.bg_color}};"> <!-- Change backgroud -->
                    <!-- <thead class="thead-light">
                      <tr>
                        <th class="text-xs"></th>
                        <th class="text-xs text-white">Precio en base a nombre de hotel</th>
                        <th class="text-xs text-white">H. DSP. (4*)</th>
                        <th class="text-xs text-white">Precio hotel 3*</th>
                        <th class="text-xs text-white">Precio hotel 4*</th>
                        <th class="text-xs text-white">Media</th>
                      </tr>
                    </thead> -->
                    <tbody>
                      <!-- <tr>
                        <td colspan="6">
                          <div class="input-group mb-3">
                            <button class="btn btn-white btn-xs mb-0 text-lg" type="button" id="button-addon8" onclick="saveEvent('{{date}}', 3)">Guardar</button>
                            <input type="text" class="form-control form-control-lg text-lg" placeholder="Fijar evento" value="{{value.3.eventByDay.text}}" aria-describedby="button-addon8" id="textEvent{{date}}3">
                          </div>
                        </td>
                      </tr> -->
                      
                      <tr class="m-1 p-1">
                        <td class="text-sm m-1 p-1">
                          <span id="textDate{{date}}3" class="text-lg m-2">{{value.3.messageDay.updated}}</span>
                          <div class="input-group mb-3">
                            <button class="btn btn-white btn-xs mb-0 text-lg" type="button" id="button-addon6" onclick="saveMessage('{{date}}', 3, '{{date}}3')">Guardar</button>
                            <select type="text" class="form-control form-control-lg text-lg" value="{{value.3.messageDay.text}}" aria-describedby="button-addon6" id="text{{date}}3">
                              {% for mn in message_name3 %} 
                                <option value="{{mn.pk}}" {% if value.3.messageDay.pk == mn.pk %}selected{% endif %} style="background-color: {{mn.bg_color}};">{{mn.name}}</option>
                              {% endfor %}
                            </select>
                          </div>
                          <span class="text-white text-lg" id="priceDate{{date}}3">{{value.3.tarifa.updated}}</span>
                          <div class="input-group mb-3">
                            <button class="btn btn-white btn-xs mb-0" style="font-size: 14px;" type="button" id="button-addon3" onclick="savePrice('{{date}}', 3, '{{date}}3')">
                              Guardar <i id="iconStatus{{date}}3" class="{% if not value.3.tarifa.pSync %}fas fa-exclamation-triangle text-warning fa-2x{% else %}fa fa-check text-success fa-2x{% endif %}"></i>
                            </button>
                            <input type="text" class="form-control form-control-lg text-lg w-15" placeholder="Tarifa RoomPrice" value="{{value.3.tarifa.price}}" aria-describedby="button-addon3" id="price{{date}}3">
                          </div>
                          <span class="text-white text-lg" id="priceDate{{date}}4">{{value.3.tarifa1.updated}}</span>
                          <div class="input-group mb-3">
                            <button class="btn btn-white btn-xs mb-0" style="font-size: 14px;" type="button" id="button-addon3" onclick="savePrice('{{date}}', 4, '{{date}}4')">
                              Guardar <i id="iconStatus{{date}}4" class="{% if not value.3.tarifa1.pSync %}fas fa-exclamation-triangle text-warning fa-2x{% else %}fa fa-check text-success fa-2x{% endif %}"></i>
                            </button>
                            <input type="text" class="form-control form-control-lg text-lg w-15" placeholder="Tarifa RoomPrice" value="{{value.3.tarifa1.price}}" aria-describedby="button-addon3" id="price{{date}}4">
                          </div>
                          <!-- <h4 class="text-white text-center">
                            {% if "suiteFeria" in value.3 %}{{value.3.suiteFeria}}{% else %}-{% endif %} | 
                            {% if "priceSuitesFeriaRest1" in value.3 %}{{value.3.priceSuitesFeriaRest1}}{% else %}0{% endif %} | 
                            {% if "priceSuitesFeriaRest7" in value.3 %}{{value.3.priceSuitesFeriaRest7}}{% else %}0{% endif %}
                          </h4> -->
                        </td>
                        <td class="text-sm tr m-1 p-1" data-bs-toggle="tooltip" data-bs-placement="left" title="Ir a lista de triples" onclick="window.location.href='/booking?date={{date}}&occupancy=3'">
                          <h2 class="text-white bg-success text-center">0</h2>
                          <h4 class="text-white text-start">
                            <span class="h3 text-bold text-white">{% if "priceSuitesFeria" in value.3 %}{{value.3.priceSuitesFeria}}{% else %}0{% endif %} | </span>
                            {% if "priceSuitesFeria1" in value.3 %}{{value.3.priceSuitesFeria1}}{% else %}0{% endif %} | 
                            {% if "priceSuitesFeria7" in value.3 %}{{value.3.priceSuitesFeria7}}{% else %}0{% endif %}
                          </h4>
                          <h4 class="text-white text-start">
                            <span class="h2 text-bold text-white bg-dark">{% if "totalFeria" in value.3 %}{{value.3.totalFeria}}{% else %}0{% endif %} | 
                            {% if "totalFeria1" in value.3 %}{{value.3.totalFeria1}}{% else %}0{% endif %} | 
                            {% if "totalFeria7" in value.3 %}{{value.3.totalFeria7}}{% else %}0{% endif %}</span>
                          </h4>
                        </td>
                        <td class="text-sm tr m-1 p-1" data-bs-toggle="tooltip" data-bs-placement="left" title="Ir a lista de triples" onclick="window.location.href='/booking?date={{date}}&occupancy=3'">
                          <table>
                            <tbody>
                              <tr>
                                <td>
                                  <h4 class="text-white text-start">
                                    <span class="h3 text-bold text-white">{% if "media_total" in value.5 %}{% widthratio value.3.media_total value.3.media_cant 1 %}{% else %}0{% endif %} | </span>
                                    {% if "media_total1" in value.5 %}{% widthratio value.3.media_total1 value.3.media_cant1 1 %}{% else %}0{% endif %} | 
                                    {% if "media_total7" in value.5 %}{% widthratio value.3.media_total7 value.3.media_cant7 1 %}{% else %}0{% endif %}
                                  </h4>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                          <table class="table table-flush text-white table-sm m-1 p-1">
                            <tbody>
                              <tr>
                                <td class="text-sm bg-success m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0">{{value.3.4.0.price}}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      1
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.3.4.1.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      2
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.3.4.2.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      3
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.3.4.3.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      4
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0 text-white">{{value.3.4.4.price}}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      5
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0 text-white">00</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 60px; height: 12px; font-size: 10px;">
                                      5D-10D
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-white m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0">{{value.3.4.9.price}}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      10
                                    </span>
                                  </div>
                                </td>
                              </tr>
                            </tr>
                            </tbody>
                          </table>
                          <table class="table table-flush text-white table-sm m-1 p-1">
                            <tbody>
                              <tr>
                                <td class="text-sm bg-success m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h2 class="m-0">{{value.3.3.0.price}}</h2>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      I
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.3.3.1.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      II
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.3.3.2.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      III
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.3.3.3.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      IV
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-white m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0">{{value.3.3.4.price}}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      V
                                    </span>
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </td>
                        <td class="text-sm bg-warning text-white tr m-1 p-1" data-bs-toggle="tooltip" data-bs-placement="left" title="Ir a lista de triples" onclick="window.location.href='/booking?date={{date}}&occupancy=3'">
                          <table class="table table-flush text-white table-sm m-1 p-1">
                            <tbody>
                              <tr>
                                <td class="text-sm m-1 p-1">
                                  <span class="h4 text-bold text-white">TOR: {% if 'priceTOR' in value.3 %}{{value.3.priceTOR}}{% else %}0{% endif %}</span><br>
                                  <span class="h4 text-bold text-white">BAR: {% if 'priceBAR' in value.3 %}{{value.3.priceBAR}}{% else %}0{% endif %}</span>
                                  <h4 class="text-white text-start bg-danger">
                                    <span class="h5 text-bold text-white">{{value.3.total_search}} | </span>
                                    <span class="h5 text-bold text-white">{{value.3.total_search1}}</span> |
                                    <span class="h5 text-bold text-white">{{value.3.total_search7}}</span>
                                  </h4>
                                  <h5 class="h5 text-bold text-white bg-danger">{{value.3.total_search_192}}%</h5>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </td>
                        <td class="text-sm bg-danger text-white tr m-1 p-1" data-bs-toggle="tooltip" data-bs-placement="left" title="Ir a lista de dobles" onclick="window.location.href='/booking?date={{date}}&occupancy=2'">
                          <table class="table table-flush text-white table-sm m-1 p-1">
                            <tbody>
                              <tr>
                                <td class="text-sm m-1 p-1">
                                  <span class="h4 text-bold text-white m-2">PM+50%: 0</span>
                                  <br>
                                  <span class="h4 text-bold text-white m-2">PM+40%: 0</span>
                                  <br>
                                  <span class="h4 text-bold text-white m-2">PM+30%: 0</span>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </td>
                      </tr>
                      <!-- <tr>
                        <td colspan="6">
                          <span id="textDate{{date}}3" class="text-lg">{{value.3.messageDay.updated}}</span>
                          <div class="input-group mb-3">
                            <button class="btn btn-white btn-xs mb-0 text-lg" type="button" id="button-addon4" onclick="saveMessage('{{date}}', 3, '{{date}}3')">Guardar</button>
                            <input type="text" class="form-control form-control-lg text-lg" placeholder="Fija un mensaje para este tipo" value="{{value.3.messageDay.text}}" aria-describedby="button-addon4" id="text{{date}}3">
                          </div>
                        </td>
                      </tr> -->
                    </tbody>
                  </table>

                  <table class="table table-flush text-white table-sm m-1 p-1" id="bgtable{{date}}5" style="background-color: {{value.5.messageDay.bg_color}};"> <!-- Change backgroud -->
                    <!-- <thead class="thead-light">
                      <tr>
                        <th class="text-xs"></th>
                        <th class="text-xs text-white">Precio en base a nombre de hotel</th>
                        <th class="text-xs text-white">H. DSP. (4*)</th>
                        <th class="text-xs text-white">Precio hotel 3*</th>
                        <th class="text-xs text-white">Precio hotel 4*</th>
                        <th class="text-xs text-white">Media</th>
                      </tr>
                    </thead> -->
                    <tbody>
                      <!-- <tr>
                        <td colspan="6">
                          <div class="input-group mb-3">
                            <button class="btn btn-white btn-xs mb-0 text-lg" type="button" id="button-addon9" onclick="saveEvent('{{date}}', 5)">Guardar</button>
                            <input type="text" class="form-control form-control-lg text-lg" placeholder="Fijar evento" value="{{value.5.eventByDay.text}}" aria-describedby="button-addon9" id="textEvent{{date}}5">
                          </div>
                        </td>
                      </tr> -->
                      <tr>
                        <td class="text-sm m-1 p-1">
                          <span id="textDate{{date}}5" class="text-lg m-2">{{value.5.messageDay.updated}}</span>
                          <div class="input-group mb-3">
                            <button class="btn btn-white btn-xs mb-0 text-lg" type="button" id="button-addon6" onclick="saveMessage('{{date}}', 5, '{{date}}5')">Guardar</button>
                            <select type="text" class="form-control form-control-lg text-lg" value="{{value.5.messageDay.text}}" aria-describedby="button-addon6" id="text{{date}}5">
                              {% for mn in message_name5 %} 
                                <option value="{{mn.pk}}" {% if value.5.messageDay.pk == mn.pk %}selected{% endif %} style="background-color: {{mn.bg_color}};">{{mn.name}}</option>
                              {% endfor %}
                            </select>
                          </div>
                          <span class="text-white text-lg" id="priceDate{{date}}5">{{value.5.tarifa.updated}}</span>
                          <div class="input-group mb-3">
                            <button class="btn btn-white btn-xs mb-0" style="font-size: 14px;" type="button" id="button-addon5" onclick="savePrice('{{date}}', 5, '{{date}}5')">
                              Guardar<i id="iconStatus{{date}}5" class="{% if not value.5.tarifa.pSync %}fas fa-exclamation-triangle text-warning fa-2x{% else %}fa fa-check text-success fa-2x{% endif %}"></i>
                            </button>
                            <input type="text" class="form-control form-control-lg text-lg 1-15" placeholder="Tarifa RoomPrice" value="{{value.5.tarifa.price}}" aria-describedby="button-addon5" id="price{{date}}5">
                          </div>
                          <span class="text-white text-lg" id="priceDate{{date}}6">{{value.5.tarifa1.updated}}</span>
                          <div class="input-group mb-3">
                            <button class="btn btn-white btn-xs mb-0" style="font-size: 14px;" type="button" id="button-addon5" onclick="savePrice('{{date}}', 6, '{{date}}6')">
                              Guardar <i id="iconStatus{{date}}6" class="{% if not value.5.tarifa1.pSync %}fas fa-exclamation-triangle text-warning fa-2x{% else %}fa fa-check text-success fa-2x{% endif %}"></i>
                            </button>
                            <input type="text" class="form-control form-control-lg text-lg w-15" placeholder="Tarifa RoomPrice" value="{{value.5.tarifa1.price}}" aria-describedby="button-addon5" id="price{{date}}6">
                          </div>
                          <!-- <h4 class="text-white text-center">
                            {% if "suiteFeria" in value.5 %}{{value.5.suiteFeria}}{% else %}0{% endif %} | 
                            {% if "priceSuitesFeriaRest1" in value.5 %}{{value.5.priceSuitesFeriaRest1}}{% else %}0{% endif %} | 
                            {% if "priceSuitesFeriaRest7" in value.5 %}{{value.5.priceSuitesFeriaRest7}}{% else %}0{% endif %}
                          </h4> -->
                        </td>
                        <td class="text-sm tr m-1 p-1" data-bs-toggle="tooltip" data-bs-placement="left" title="Ir a lista de suite" onclick="window.location.href='/booking?date={{date}}&occupancy=5'">
                          <h2 class="text-white bg-success text-center">0</h2>
                          <h4 class="text-white text-start">
                            <span class="h3 text-bold text-white">{% if "priceSuitesFeria" in value.5 %}{{value.5.priceSuitesFeria}}{% else %}0{% endif %} | </span>
                            {% if "priceSuitesFeria1" in value.5 %}{{value.5.priceSuitesFeria1}}{% else %}0{% endif %} | 
                            {% if "priceSuitesFeria7" in value.5 %}{{value.5.priceSuitesFeria7}}{% else %}0{% endif %} 
                          </h4>
                          <h4 class="text-white text-start">
                            <span class="h2 text-bold text-white bg-dark">{% if "totalFeria" in value.5 %}{{value.5.totalFeria}}{% else %}0{% endif %} | 
                            {% if "totalFeria1" in value.5 %}{{value.5.totalFeria1}}{% else %}0{% endif %} | 
                            {% if "totalFeria7" in value.5 %}{{value.5.totalFeria7}}{% else %}0{% endif %}</span>
                          </h4>
                        </td>
                        <td class="text-sm tr m-1 p-1" data-bs-toggle="tooltip" data-bs-placement="left" title="Ir a lista de suite" onclick="window.location.href='/booking?date={{date}}&occupancy=5'">
                          <table class="m-1 p-1">
                            <tbody>
                              <tr>
                                <td class="m-1 p-1">
                                  <h4 class="text-white text-start">
                                    <span class="h3 text-bold text-white">{% if "media_total" in value.5 %}{% widthratio value.5.media_total value.5.media_cant 1 %}{% else %}0{% endif %} | </span>
                                    {% if "media_total1" in value.5 %}{% widthratio value.5.media_total1 value.5.media_cant1 1 %}{% else %}0{% endif %} | 
                                    {% if "media_total7" in value.5 %}{% widthratio value.5.media_total7 value.5.media_cant7 1 %}{% else %}0{% endif %}
                                  </h4>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                          <table class="table table-flush text-white table-sm m-1 p-1">
                            <tbody>
                              <tr>
                                <td class="text-sm bg-success m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0">{{value.5.4.0.price}}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      1
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.5.4.1.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      2
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.5.4.2.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      3
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.5.4.3.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      4
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0 text-white">{{value.5.4.4.price}}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      5
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0 text-white">00</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 60px; height: 12px; font-size: 10px;">
                                      5D-10D
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-white m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0">{{value.5.4.9.price}}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      10
                                    </span>
                                  </div>
                                </td>
                              </tr>
                            </tr>
                            </tbody>
                          </table>
                          <table class="table table-flush text-white table-sm m-1 p-1">
                            <tbody>
                              <tr>
                                <td class="text-sm bg-success m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h2 class="m-0">{{value.5.3.0.price}}</h2>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      I
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.5.3.1.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      II
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.5.3.2.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      III
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm bg-secondary m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h5 class="m-0 text-white">{{value.5.3.3.price}}</h5>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      IV
                                    </span>
                                  </div>
                                </td>
                                <td class="text-sm  bg-white m-1 p-1">
                                  <div class="d-flex flex-column align-items-center">
                                    <h3 class="m-0">{{value.5.3.4.price}}</h3>
                                    <span 
                                      class="badge rounded-circle bg-dark text-white d-inline-flex justify-content-center align-items-center mt-0"
                                      style="width: 30px; height: 12px; font-size: 10px;">
                                      V
                                    </span>
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </td>
                        <td class="text-sm bg-warning text-white tr m-1 p-1" data-bs-toggle="tooltip" data-bs-placement="left" title="Ir a lista de suite" onclick="window.location.href='/booking?date={{date}}&occupancy=5'">
                          <table class="table table-flush text-white table-sm m-1 p-1">
                            <tbody>
                              <tr>
                                <td class="text-sm m-1 p-1">
                                  <span class="h4 text-bold text-white">AZA: {% if 'priceAZA' in value.5 %}{{value.5.priceAZA}}{% else %}0{% endif %}</span><br>
                                  <span class="h4 text-bold text-white">ECO: {% if 'priceECO' in value.5 %}{{value.5.priceECO}}{% else %}0{% endif %}</span>
                                  <br>
                                  <h4 class="text-white text-start bg-danger">
                                    <span class="h5 text-bold text-white">{{value.5.total_search}}</span> | 
                                    <span class="h5 text-bold text-white">{{value.3.total_search1}}</span> |
                                    <span class="h5 text-bold text-white">{{value.3.total_search7}}</span>
                                  </h4>
                                  <h5 class="h5 text-bold text-white bg-danger">{{value.5.total_search_192}}%</h5>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </td>
                        <td class="text-sm bg-danger text-white tr m-1 p-1" data-bs-toggle="tooltip" data-bs-placement="left" title="Ir a lista de dobles" onclick="window.location.href='/booking?date={{date}}&occupancy=2'">
                          <table class="table table-flush text-white table-sm m-1 p-1">
                            <tbody>
                              <tr>
                                <td class="text-sm m-1 p-1">
                                  <span class="h4 text-bold text-white m-2">PM+60%: 0</span>
                                  <br>
                                  <span class="h4 text-bold text-white m-2">PM+50%: 0</span>
                                  <br>
                                  <span class="h4 text-bold text-white m-2">PM+40%: 0</span>
                                  <br>
                                  <span class="h4 text-bold text-white m-2">PM+30%: 0</span>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </td>
                      </tr>
                      <!-- <tr>
                        <td colspan="6">
                          <span id="textDate{{date}}5" class="text-lg">{{value.5.messageDay.updated}}</span>
                          <div class="input-group mb-3">
                            <button class="btn btn-white btn-xs mb-0 text-lg" type="button" id="button-addon6" onclick="saveMessage('{{date}}', 5, '{{date}}5')">Guardar</button>
                            <input type="text" class="form-control form-control-lg text-lg" placeholder="Fija un mensaje para este tipo" value="{{value.5.messageDay.text}}" aria-describedby="button-addon6" id="text{{date}}5">
                          </div>
                        </td>
                      </tr> -->
                    </tbody>
                  </table>
                </td>
              </tr>
              {% endfor %}
            </tbody>
            <tfoot>
              <tr>
                <th class="text-xs">Fecha</th>
                <th class="text-xs"></th>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="stadistics" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="ModalLabel">Disponibilidad </h5>
        <i class="fa fa-bar-chart m-2"></i>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row mt-4 h-30">
          <div class="col-md-12">
            <div class="card z-index-2">
              <div class="card-header p-3 pb-0">
                <h6></h6>
              </div>
              <div class="card-body p-3">
                <div class="chart">
                  <canvas id="lineStad" class="chart-canvas" height="300"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-white btn-sm" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="stadistics2" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="ModalLabel">Tarifas </h5>
        <i class="fa fa-bar-chart m-2"></i>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row mt-4 h-30">
          <div class="col-md-12">
            <div class="card z-index-2">
              <div class="card-header p-3 pb-0">
                <h6></h6>
              </div>
              <div class="card-body p-3">
                <div class="chart">
                  <canvas id="lineStad2" class="chart-canvas" height="300"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-white btn-sm" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="btn-disp bg-gradient-warning text-white text-bold text-lg">
	<a href="#javascript:;" data-bs-toggle="modal" data-bs-target="#stadistics" class="text-white">
		<i class="fa fa-bar-chart py-2"></i> Dispo
	</a>
</div>

<div class="btn-tar bg-gradient-warning text-white text-bold text-lg">
	<a href="#javascript:;" data-bs-toggle="modal" data-bs-target="#stadistics2" class="text-white">
		<i class="fa fa-bar-chart py-2"></i> Tarifa
	</a>
</div>

{% include 'includes/scripts.html' %}

<script>
    
    if (document.getElementById('client-list')) {
      const dataTableSearch = new simpleDatatables.DataTable("#client-list", {
        searchable: false,
        fixedHeight: false,
        lengthChange: false,
        perPage: parseInt('{{range_pg}}') + 1
      });

      document.querySelectorAll(".export").forEach(function(el) {
        el.addEventListener("click", function(e) {
          var type = el.dataset.type;

          var data = {
            type: type,
            filename: "soft-ui-" + type,
          };

          if (type === "csv") {
            data.columnDelimiter = "|";
          }

          dataTableSearch.export(data);
        });
      });
    };

    function activeAlert(){
        Swal.fire({
        title: 'Activar Proceso de extraccion.',
        text: "!¿Está seguro de activar el proceso?!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Si!',
        cancelButtonText: 'Cancelar'
      }).then((result) => {
        if (result.isConfirmed){
          activeProcess();
        }
      })
    }
    function finishactiveAlert(){
        Swal.fire({
        title: 'Desactivar Proceso de extraccion.',
        text: "!¿Está seguro de desactivar el proceso?!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Si!',
        cancelButtonText: 'Cancelar'
      }).then((result) => {
        if (result.isConfirmed){
          finishactiveProcess();
        }
      })
    }

    function activeProcess(){
      var _dateFrom = document.getElementById("date_process_from").value;
      var _dateTo = document.getElementById("date_process").value;
      if (_dateFrom != "" && _dateTo != ""){
        $.ajax({
          url: '/get/booking',
          type: 'POST',
          data:{
            dateFrom: _dateFrom,
            date: _dateTo,
            automatic: $("#bot_auto").prop("checked")
            //bot_range: document.getElementById("bot_range").value
          },
          headers: {"X-CSRFToken": $('[name=csrfmiddlewaretoken]').val()},
          success: function(json) {
            console.log(json);
            checkActiveProcess();
            Swal.fire({
              title: 'Proceso activado',
              text: "!"+json.message+"!",
              icon: 'warning',
              confirmButtonColor: '#3085d6',
              cancelButtonColor: '#d33',
              confirmButtonText: 'Aceptar!',
            });
          },
          error: function(error) {
            console.log("Ocurrio un error");
          }
        });
      }else{
        alert("Por favor agregue una fecha: Desde - Hasta")
      }
    }
    function finishactiveProcess(){
      $.ajax({
          url: '/finish/get/booking',
          type: 'POST',
          data:{
            dateFrom: document.getElementById("date_process_from").value,
            date: document.getElementById("date_process").value
          },
          headers: {"X-CSRFToken": $('[name=csrfmiddlewaretoken]').val()},
          success: function(json) {
            console.log(json);
            checkActiveProcess();
            Swal.fire({
              title: 'Proceso desactivado',
              text: "!"+json.message+"!",
              icon: 'warning',
              confirmButtonColor: '#3085d6',
              cancelButtonColor: '#d33',
              confirmButtonText: 'Aceptar!',
            });
          },
          error: function(error) {
            console.log("Ocurrio un error");
          }
      });
    }
    function checkActiveProcess(){
      $.ajax({
          url: '/check/booking/process',
          type: 'POST',
          data:{
            date:document.getElementById("date_from").value,
            days:document.getElementById("range_pg").value
          },
          headers: {"X-CSRFToken": $('[name=csrfmiddlewaretoken]').val()},
          success: function(json) {
            if (json.active){
              $("#buttonActive").prop("disabled", json.task.status);
              $("#buttonActive").text("Desactivar Bot");
              $("#buttonActive").prop("class", "mt-4 btn w-100 btn-success");
              $("#buttonActive").off("click").on("click", function() {
                finishactiveAlert();
              });
            }else{
              $("#buttonActive").text("Activar Bot");
              $("#buttonActive").prop("class", "mt-4 btn w-100 btn-danger");
              $("#buttonActive").prop("disabled", json.current);// deshabilitamos el boton si aun sigue activo el bot, hasta que termine.
              $("#buttonActive").off("click").on("click", function() {
                activeAlert();
              });
            }
            $("#addLogBooking").text("");
            $("#addLogRoomPrice").text("");
            $("#addLogSuitesFeria").text("");
            $("#addLogCopyPrice").text("");

            if (json.botLog && json.botLog?.booking !== undefined) {
              $("#addLogBooking").append(json.botLog.booking.description+" | "+json.botLog.booking.created);
            } else {
              $("#addLogBooking").append("Historial de proceso no disponible");
            }
            
            if (json.botLog && json.botLog?.roomprice !== undefined) {
              $("#addLogRoomPrice").append(json.botLog.roomprice.description+" | "+json.botLog.roomprice.created);
            } else {
              $("#addLogRoomPrice").append("Historial de proceso no disponible");
            }

            if (json.botLog && json.botLog?.suitesferia !== undefined) {
              $("#addLogSuitesFeria").append(json.botLog.suitesferia.description+" | "+json.botLog.suitesferia.created);
            } else {
              $("#addLogSuitesFeria").append("Historial de proceso no disponible");
            }

            if (json.task && json.task?.current !== undefined) {
              $("#addLogCopyPrice").append("[+] Proxima copia: "+json.task.next+" | Copia actual: "+json.task.current+" | Horario: "+json.task.now+" | "+json.task.copy);
            } else {
              $("#addLogCopyPrice").append("Horario de copia de precio no disponible");
            }
            json.status_price.map(function(value, index){
              value.map(function(value2, index2){
                //console.log(value2);
                changeStatusPRice(value2.date_from+""+value2.occupancy, value2.pSync);
              });
            });
          },
          error: function(error) {
            console.log("Ocurrio un error");
          }
      });
    }
    function saveMessage(_date, occupancy, inputId){
      inputText = document.getElementById("text"+inputId).value;
      $.ajax({
          url: '/save/message',
          type: 'POST',
          data:{
            date: _date,
            occupancy: occupancy,
            text: inputText
          },
          headers: {"X-CSRFToken": $('[name=csrfmiddlewaretoken]').val()},
          success: function(json) {
            console.log(json);
            if (json.code == 200){
              $("#textDate"+inputId).text("");
              $("#textDate"+inputId).append(json.updated);

              $("#bgtable" + inputId).css("background", json.bg_color);
            }
          },
          error: function(error) {
            console.log("Ocurrio un error");
          }
      });
    }
    function saveEvent(_date, occupancy){
      inputText = document.getElementById("textEvent"+_date+occupancy).value;
      $.ajax({
          url: '/save/event',
          type: 'POST',
          data:{
            date: _date,
            occupancy: occupancy,
            text: inputText
          },
          headers: {"X-CSRFToken": $('[name=csrfmiddlewaretoken]').val()},
          success: function(json) {
            console.log(json);
          },
          error: function(error) {
            console.log("Ocurrio un error");
          }
      });
    }
    function savePrice(_date, occupancy, inputId){
      inputText = document.getElementById("price"+inputId).value;
      showLoader("priceDate"+inputId);
      $.ajax({
          url: '/save/price',
          type: 'POST',
          data:{
            date: _date,
            occupancy: occupancy,
            text: inputText
          },
          headers: {"X-CSRFToken": $('[name=csrfmiddlewaretoken]').val()},
          success: function(json) {
            console.log(json);
            if (json.code == 200){
              $("#priceDate"+inputId).text("");
              $("#priceDate"+inputId).append(json.updated);

              changeStatusPRice(inputId, json.pSync);
            }
          },
          error: function(error) {
            console.log("Ocurrio un error");
          }
      });
    }
    function changeStatusPRice(inputId, status){
      let icon = document.getElementById("iconStatus"+inputId);
      if (status == true) {
          icon.classList.remove("fa-exclamation-triangle", "text-warning");
          icon.classList.add("fa-check", "text-success");
      } else {
          icon.classList.remove("fa-check", "text-success");
          icon.classList.add("fa-exclamation-triangle", "text-warning");
      }
    }
    let timeoutHandles = {}
    function upgradeFee(_date){
      showLoader("buttonFeeUpgrade"+_date);
      $.ajax({
          url: '/upgrade/fee',
          type: 'POST',
          data:{
            date: _date
          },
          headers: {"X-CSRFToken": $('[name=csrfmiddlewaretoken]').val()},
          success: function(json) {
            console.log(json);
            console.log(json.time * 1000);
            if (json.code == 200){
              if (timeoutHandles[_date]) {
                clearTimeout(timeoutHandles[_date]);
              }
              timeoutHandles[_date] = setTimeout(function(){
                $("#buttonFeeUpgrade" + _date).text("...");
                delete timeoutHandles[_date];
              },json.time * 1000);
            }
          },
          error: function(error) {
            console.log("Ocurrio un error");
          }
      });
    }
    function showLoader(inputId){
      console.log("Loader");
      $("#"+inputId).text("");
      $("#"+inputId).append(
        '<div class="spinner-grow text-dark text-center" role="status">'+
          '<span class="sr-only">Loading...</span>'+
        '</div>'
      );
    }
    function tempOption(_date){
      numTemp = document.getElementById("temp"+_date).value;
      $.ajax({
        url: '/save/temp',
        type: 'POST',
        data:{
          numTemp: numTemp,
          date:_date
        },
        headers: {"X-CSRFToken": $('[name=csrfmiddlewaretoken]').val()},
        success: function(json) {
          //console.log(json);
          //window.location.href = "{{request.path}}";
          //json.bg_color;
          $("#temp-bg"+_date).prop("class", "w-15 text-sm text-center "+json.bg_color);
          $("#temp-n"+_date).text(numTemp);
          var texto = $("#temp-n2"+_date).text();
          if (parseInt(texto) < 0 && json.bg_color == "bg-danger"){
            $("#temp-n2"+_date).addClass("bg-white");
          }else{
            $("#temp-n2"+_date).removeClass("bg-white");
          }
          $("#temp-update"+_date).addClass("text-white");
        },
        error: function(error) {
          console.log("Ocurrio un error");
        }
      });
    }
    function saveAvailWithDate(_date){
      _avail = document.getElementById("avail"+_date).value
      $.ajax({
        url: '/save/avail/with/date',
        type: 'POST',
        data:{
          avail: _avail,
          date:_date
        },
        headers: {"X-CSRFToken": $('[name=csrfmiddlewaretoken]').val()},
        success: function(json) {
          console.log(json);
          //window.location.href = "{{request.path}}";
          numTemp = document.getElementById("temp"+_date).value;
          var texto = $("#temp-t"+_date).text();
          $("#temp-n2"+_date).text(parseInt(texto) - parseInt(_avail));
          console.log((parseInt(texto) - parseInt(_avail)));
          if ((parseInt(texto) - parseInt(_avail)) < 0){
            $("#temp-n2"+_date).removeClass("text-white");
            $("#temp-n2"+_date).addClass("text-danger");
            if (parseInt(numTemp) == 1){
              $("#temp-n2"+_date).addClass("bg-white");
            }else{
              $("#temp-n2"+_date).removeClass("bg-white");
            }
          }else{
            $("#temp-n2"+_date).removeClass("text-danger");
            $("#temp-n2"+_date).addClass("text-white");
            $("#temp-n2"+_date).removeClass("bg-white");
          }
        },
        error: function(error) {
          console.log("Ocurrio un error");
        }
      });
    }
    checkActiveProcess();
    setInterval(function(){
      checkActiveProcess();
    },7000);

    //document.body.style.transform = "scale(0.9)";
    //document.body.style.transformOrigin = "0 0"; // Establece el origen de la transformación
    //document.body.style.zoom = "90%";
    
    var ctx1 = document.getElementById("lineStad").getContext("2d");

    var gradientStroke = ctx1.createLinearGradient(0, 230, 0, 50);

    gradientStroke.addColorStop(1, 'rgba(94, 114, 228, 0.2)');
    gradientStroke.addColorStop(0.2, 'rgba(72,72,176,0.0)');
    gradientStroke.addColorStop(0, 'rgba(94, 114, 228,0)'); //purple colors

    var gradientStroke2 = ctx1.createLinearGradient(0, 230, 0, 50);

    gradientStroke2.addColorStop(1, 'rgba(20,23,39,0.2)');
    gradientStroke2.addColorStop(0.2, 'rgba(72,72,176,0.0)');
    gradientStroke2.addColorStop(0, 'rgba(20,23,39,0)'); //purple colors

    dataStat2 = []
    dataStat3 = []
    dataStat5 = []
    totalFeria = []
    totalTemp = []
    dataStatName = []
    '{% for date, value in bookings.items %}'
      dataStat2.push('{{value.2.total_search}}');
      dataStat3.push('{{value.3.total_search}}');
      dataStat5.push('{{value.5.total_search}}');
      totalFeria.push('{{value.totalFeria}}');
      totalTemp.push('{{value.temporadaByDay.number}}');
      
      dataStatName.push('{{value.date_from}}');
    '{% endfor %}'

    new Chart(ctx1, {
      type: "line",
      data: {
        labels: dataStatName,
        datasets: [{
            label: "Dobles",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#0dcaf0",
            borderColor: "#0dcaf0",
            borderWidth: 3,
            backgroundColor: gradientStroke,
            data: dataStat2,
            maxBarThickness: 6
          },
          {
            label: "Triples",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#2dce89",
            borderColor: "#2dce89",
            borderWidth: 3,
            backgroundColor: gradientStroke2,
            data: dataStat3,
            maxBarThickness: 6
          },
          {
            label: "Suites",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#f5365c",
            borderColor: "#f5365c",
            borderWidth: 3,
            backgroundColor: gradientStroke2,
            data: dataStat5,
            maxBarThickness: 6
          },
          {
            label: "Disp",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#5e72e4",
            borderColor: "#5e72e4",
            borderWidth: 3,
            backgroundColor: gradientStroke2,
            data: totalFeria,
            maxBarThickness: 6,
            hidden: true
          },
          {
            label: "Temp",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#fb6340",
            borderColor: "#fb6340",
            borderWidth: 3,
            backgroundColor: gradientStroke2,
            data: totalTemp,
            maxBarThickness: 6,
            hidden: true
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: true,
            position: 'top',
            align: 'end',
            labels: {
              boxWidth: 6,
              boxHeight: 6,
              padding: 20,
              pointStyle: 'circle',
              borderRadius: 50,
              usePointStyle: true,
              font: {
                weight: 600,
              },
            },
            tooltip: {
              backgroundColor: '#fff',
              titleColor: '#1e293b',
              bodyColor: '#1e293b',
              borderColor: '#e9ecef',
              borderWidth: 1,
              pointRadius: 2,
              usePointStyle: true,
              boxWidth: 8,
            }
          }
        },
        interaction: {
          intersect: false,
          mode: 'index',
        },
        scales: {
          y: {
            grid: {
              drawBorder: false,
              display: true,
              drawOnChartArea: true,
              drawTicks: false,
              borderDash: [5, 5]
            },
            ticks: {
              display: true,
              padding: 10,
              color: '#b2b9bf',
              font: {
                size: 11,
                family: "Open Sans",
                style: 'normal',
                lineHeight: 2
              },
            }
          },
          x: {
            grid: {
              drawBorder: false,
              display: true,
              drawOnChartArea: true,
              drawTicks: true,
              borderDash: [5, 5]
            },
            ticks: {
              display: true,
              color: '#b2b9bf',
              padding: 10,
              font: {
                size: 11,
                family: "Open Sans",
                style: 'normal',
                lineHeight: 2
              },
            }
          },
        },
      },
    });

    var ctx2 = document.getElementById("lineStad2").getContext("2d");

    dataSuitesFeria = []
    dataZenit = []
    dataOsuna = []
    dataIlunion = []
    dataEco = []
    dataSilken = []
    dataExe = []
    dataSercotel = []
    dataAxor = []
    dataDwo = []
    dataBoston = []
    dataSenator = []
    dataTor2 = []
    dataMedia = []

    dataStatName = []
    '{% for date, value in bookings.items %}'
      dataZenit.push("{% if 'priceZEN' in value.2 %}{{value.2.priceZEN}}{% else %}0{% endif %}");
      dataOsuna.push("{% if 'priceOSU' in value.2 %}{{value.2.priceOSU}}{% else %}0{% endif %}");
      dataSuitesFeria.push("{% if 'priceSF' in value.2 %}{{value.2.priceSF}}{% else %}0{% endif %}");
      dataIlunion.push("{% if 'priceILU' in value.2 %}{{value.2.priceILU}}{% else %}0{% endif %}");
      dataEco.push("{% if 'priceECO' in value.2 %}{{value.2.priceECO}}{% else %}0{% endif %}");
      dataSilken.push("{% if 'priceSIL' in value.2 %}{{value.2.priceSIL}}{% else %}0{% endif %}");
      dataExe.push("{% if 'priceEXE' in value.2 %}{{value.2.priceEXE}}{% else %}0{% endif %}");
      dataSercotel.push("{% if 'priceSER' in value.2 %}{{value.2.priceSER}}{% else %}0{% endif %}");
      dataAxor.push("{% if 'priceAXO' in value.2 %}{{value.2.priceAXO}}{% else %}0{% endif %}");
      dataDwo.push("{% if 'priceDWO' in value.2 %}{{value.2.priceDWO}}{% else %}0{% endif %}");
      dataBoston.push("{% if 'priceBOS' in value.2 %}{{value.2.priceBOS}}{% else %}0{% endif %}");
      dataSenator.push("{% if 'priceSEN' in value.2 %}{{value.2.priceSEN}}{% else %}0{% endif %}");
      dataTor2.push("{% if 'priceTOR2' in value.2 %}{{value.2.priceTOR2}}{% else %}0{% endif %}");
      dataStatName.push('{{value.date_from}}');
      dataMedia.push('{% if "media_name_hotel" in value.2 %}{% widthratio value.2.media_name_hotel value.2.media_cant_name_hotel 1 %}{% else %}0{% endif %}');
      //console.log('{{value.2.media_name_hotel}}');
      //console.log('{{value.2.media_cant_name_hotel}}');
    '{% endfor %}'

    
    new Chart(ctx2, {
      type: "line",
      data: {
        labels: dataStatName,
        datasets: [
          {
            label: "Suites Feria",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#2dce89",
            borderColor: "#2dce89",
            borderWidth: 3,
            backgroundColor: gradientStroke2,
            data: dataSuitesFeria,
            maxBarThickness: 6
          },
          {
            label: "Media",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#5e72e4",
            borderColor: "#5e72e4",
            borderWidth: 3,
            backgroundColor: gradientStroke2,
            data: dataMedia,
            maxBarThickness: 6
          },
          {
            label: "ZENIT",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#f5365c",
            borderColor: "#f5365c",
            borderWidth: 3,
            backgroundColor: gradientStroke,
            data: dataZenit,
            maxBarThickness: 6
          },
          {
            label: "OSUNA",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#fb6340",
            borderColor: "#fb6340",
            borderWidth: 3,
            backgroundColor: gradientStroke2,
            data: dataOsuna,
            maxBarThickness: 6
          },
          {
            label: "TRAVEL",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#adb5bd",
            borderColor: "#adb5bd",
            borderWidth: 3,
            backgroundColor: gradientStroke2,
            data: dataTor2,
            maxBarThickness: 6,
            hidden: true
          },
          {
            label: "ILUNION",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#adb5bd",
            borderColor: "#adb5bd",
            borderWidth: 3,
            backgroundColor: gradientStroke2,
            data: dataIlunion,
            maxBarThickness: 6,
            hidden: true
          },
          {
            label: "ECO",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#adb5bd",
            borderColor: "#adb5bd",
            borderWidth: 3,
            backgroundColor: gradientStroke2,
            data: dataEco,
            maxBarThickness: 6,
            hidden: true
          },
          {
            label: "SILKEN",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#adb5bd",
            borderColor: "#adb5bd",
            borderWidth: 3,
            backgroundColor: gradientStroke2,
            data: dataSilken,
            maxBarThickness: 6,
            hidden: true
          },
          {
            label: "EXE",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#adb5bd",
            borderColor: "#adb5bd",
            borderWidth: 3,
            backgroundColor: gradientStroke2,
            data: dataExe,
            maxBarThickness: 6,
            hidden: true
          },
          {
            label: "SERCOTEL",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#adb5bd",
            borderColor: "#adb5bd",
            borderWidth: 3,
            backgroundColor: gradientStroke2,
            data: dataSercotel,
            maxBarThickness: 6,
            hidden: true
          },
          {
            label: "AXOR",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#adb5bd",
            borderColor: "#adb5bd",
            borderWidth: 3,
            backgroundColor: gradientStroke2,
            data: dataAxor,
            maxBarThickness: 6,
            hidden: true
          },
          {
            label: "DWO",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#adb5bd",
            borderColor: "#adb5bd",
            borderWidth: 3,
            backgroundColor: gradientStroke2,
            data: dataDwo,
            maxBarThickness: 6,
            hidden: true
          },
          {
            label: "BOSTON",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#adb5bd",
            borderColor: "#adb5bd",
            borderWidth: 3,
            backgroundColor: gradientStroke2,
            data: dataBoston,
            maxBarThickness: 6,
            hidden: true
          },
          {
            label: "SENATOR",
            tension: 0.4,
            borderWidth: 0,
            pointRadius: 2,
            pointBackgroundColor: "#adb5bd",
            borderColor: "#adb5bd",
            borderWidth: 3,
            backgroundColor: gradientStroke2,
            data: dataSenator,
            maxBarThickness: 6,
            hidden: true
          }
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: true,
            position: 'top',
            align: 'end',
            labels: {
              boxWidth: 6,
              boxHeight: 6,
              padding: 20,
              pointStyle: 'circle',
              borderRadius: 50,
              usePointStyle: true,
              font: {
                weight: 600,
              },
            },
            tooltip: {
              backgroundColor: '#fff',
              titleColor: '#1e293b',
              bodyColor: '#1e293b',
              borderColor: '#e9ecef',
              borderWidth: 1,
              pointRadius: 2,
              usePointStyle: true,
              boxWidth: 8,
            }
          }
        },
        interaction: {
          intersect: false,
          mode: 'index',
        },
        scales: {
          y: {
            grid: {
              drawBorder: false,
              display: true,
              drawOnChartArea: true,
              drawTicks: false,
              borderDash: [5, 5]
            },
            ticks: {
              display: true,
              padding: 10,
              color: '#b2b9bf',
              font: {
                size: 11,
                family: "Open Sans",
                style: 'normal',
                lineHeight: 2
              },
            }
          },
          x: {
            grid: {
              drawBorder: false,
              display: true,
              drawOnChartArea: true,
              drawTicks: true,
              borderDash: [5, 5]
            },
            ticks: {
              display: true,
              color: '#b2b9bf',
              padding: 10,
              font: {
                size: 11,
                family: "Open Sans",
                style: 'normal',
                lineHeight: 2
              },
            }
          },
        },
      },
    });
    $("#bot_auto").change(function(){
      console.log("bot_auto");
      botAutoCheck();
    });
    function botAutoCheck(){
      if ($("#bot_auto").prop("checked")){
        $("#date_process_from").prop("disabled", true);
        $("#date_process").prop("disabled", true);
        //$("#bot_range").prop("disabled", false);
      } else {
        $("#date_process_from").prop("disabled", false);
        $("#date_process").prop("disabled", false);
        //$("#bot_range").prop("disabled", true);
      }
    }
    botAutoCheck();
  </script>


{% endblock content %}
  
<!-- Specific JS goes HERE --> 
{% block javascripts %}

{% endblock javascripts %}